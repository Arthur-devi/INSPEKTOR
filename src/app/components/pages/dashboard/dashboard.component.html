<div class="dashboard-container" [@stepAnimation]>
  <div class="header">
    <h1>Dashboard de Produção</h1>
    <p class="subtitle">Visão geral dos indicadores chave da última semana.</p>
  </div>

  <div class="dashboard-columns">

    <div class="dashboard-column" *ngIf="isGestorQualidade || isAdmin">
      <h2 class="column-title"><mat-icon>science</mat-icon> Visão da Qualidade</h2>
      <div class="kpi-container">
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-producao"><mat-icon>precision_manufacturing</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Total Produzido (Kg)</div>
            <div class="kpi-value">{{ formatAsInteger(dadosQualidade.kpis.totalProduzido) }}</div>
          </div>
        </mat-card>
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-alerta"><mat-icon>warning</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Não Conformidades</div>
            <div class="kpi-value">{{ formatAsInteger(dadosQualidade.kpis.totalNaoConforme) }}</div>
          </div>
        </mat-card>
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-eficiencia"><mat-icon>dynamic_form</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Total de Submissões</div>
            <div class="kpi-value">{{ formatAsInteger(dadosQualidade.kpis.totalSubmissoes) }}</div>
          </div>
        </mat-card>
      </div>
      <div class="charts-grid">
        <mat-card class="chart-card">
          <mat-card-header><mat-card-title>Submissões por Linha</mat-card-title></mat-card-header>
          <mat-card-content>
            <ngx-charts-bar-horizontal
              [scheme]="colorScheme"
              [results]="dadosQualidade.producaoPorLinha"
              [xAxis]="true"
              [yAxis]="true"
              yAxisLabel="Linha"
              xAxisLabel="Nº de Submissões"
              [showDataLabel]="true">
            </ngx-charts-bar-horizontal>
          </mat-card-content>
        </mat-card>
        <mat-card class="chart-card">
          <mat-card-header><mat-card-title>Top 5 Operadores (por nº de submissões)</mat-card-title></mat-card-header>
          <mat-card-content>
            <ngx-charts-bar-horizontal
              [scheme]="colorScheme"
              [results]="dadosQualidade.eficienciaOperadores"
              [xAxis]="true"
              [yAxis]="true"
              xAxisLabel="Nº de Submissões"
              yAxisLabel="Operador"
              [showDataLabel]="true">
            </ngx-charts-bar-horizontal>
          </mat-card-content>
        </mat-card>
      </div>
    </div>


    <div class="dashboard-column" *ngIf="isGestorConferentes || isAdmin">
      <h2 class="column-title"><mat-icon>checklist</mat-icon> Visão dos Conferentes</h2>
      <div class="kpi-container">
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-producao"><mat-icon>fact_check</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Total de Checklists</div>
            <div class="kpi-value">{{ formatAsInteger(dadosConferentes.kpis.totalChecklists) }}</div>
          </div>
        </mat-card>
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-alerta"><mat-icon>rule</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Itens "Não Conforme"</div>
            <div class="kpi-value">{{ formatAsInteger(dadosConferentes.kpis.totalNaoConforme) }}</div>
          </div>
        </mat-card>
        <mat-card class="kpi-card">
          <div class="kpi-icon-wrapper kpi-icon-eficiencia"><mat-icon>inventory</mat-icon></div>
          <div class="kpi-content">
            <div class="kpi-title">Média de Itens/Checklist</div>
            <div class="kpi-value">{{ dadosConferentes.kpis.mediaPorChecklist }}</div>
          </div>
        </mat-card>
      </div>
      <div class="charts-grid">
        <mat-card class="chart-card">
          <mat-card-header><mat-card-title>Checklists por Linha</mat-card-title></mat-card-header>
          <mat-card-content>
            <ngx-charts-bar-horizontal
              [scheme]="colorScheme"
              [results]="dadosConferentes.checklistsPorLinha"
              [xAxis]="true"
              [yAxis]="true"
              yAxisLabel="Linha"
              xAxisLabel="Nº de Checklists"
              [showDataLabel]="true">
            </ngx-charts-bar-horizontal>
          </mat-card-content>
        </mat-card>
        <mat-card class="chart-card">
          <mat-card-header><mat-card-title>Itens Não Conformes por Categoria</mat-card-title></mat-card-header>
          <mat-card-content>
            <ngx-charts-pie-chart
              [scheme]="colorScheme"
              [results]="dadosConferentes.naoConformesPorCategoria"
              [labels]="true"
              [doughnut]="true"
              [legend]="true"
              >
            </ngx-charts-pie-chart>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>
